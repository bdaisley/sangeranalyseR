test_that("SangerRead creation test", {
})

test_that("SangerRead Initial test", {
    # hetab1 <- readsangerseq(system.file("extdata", "heterozygous.ab1", package = "sangerseqR"))
    # makeBaseCalls(hetab1)
    expect_type(A_chloroticaRead, "S4")
    expect_s4_class(A_chloroticaRead, "SangerRead")
    expect_equal(A_chloroticaRead@readFeature, "Forward Read")
    expect_equal(basename(A_chloroticaRead@readFileName), "ACHLO006-09[LCO1490_t1,HCO2198_t1]_F_1.ab1")
    expect_equal(as.character(A_chloroticaRead@primarySeq), "CACTTTATATTTTATTCTGGGCGTCTGAGCAGGAATGGTTGGAGCCGGTATAAGACTTCTAATTCGAATCGAGCTAAGACAACCAGGAGCGTTCCTGGGCAGAGACCAACTATACAATACTATCGTTACTGCACACGCATTTGTAATAATCTTCTTTCTAGTAATGCCTGTATTCATCGGGGGATTCGGAAACTGGCTTTTACCTTTAATACTTGGAGCCCCCGATATAGCATTCCCTCGACTCAACAACATGAGATTCTGACTACTTCCCCCATCACTGATCCTTTTAGTGTCCTCTGCGGCGGTAGAAAAAGGCGCTGGTACGGGGTGAACTGTTTATCCGCCTCTAGCAAGAAATCTTGCCCACGCAGGCCCGTCTGTAGATTTAGCCATCTTTTCCCTTCATTTAGCGGGTGCGTCTTCTATTCTAGGGGCTATTAATTTTATCACCACAGTTATTAATATGCGTTGAAGAGGATTACGTCTTGAACGAATTCCCCTGTTTGTCTGAGCTGTGCTAATTACAGTTGTTCTTCTACTTCTATCTTTACCAGTGCTAGCAGGTGCCATTACCATACTTCTTACCGACCGAAACCTCAATACTTCATTCTTTGATCCTGCCGGTGGTGGAGACCCCATCCTCTACTAGCACTTATTCTGATTTTTAGATCACCCTGATGTTGAGTCATACTGAATTCCTGA")
    expect_equal(as.character(A_chloroticaRead@secondarySeq), "TACTTTATATTTTATTCTGGGCGTCTGAGCAGGAATGGTTGGAGCCGGTATAAGACTTCTAATTCGAATCGAGCTAAGACAACCAGGAGCGTTCCTGGGCAGAGACCAACTATACAATACTATCGTTACTGCACACGCATTTGTAATAATCTTCTTTCTAGTAATGCCTGTATTCATCGGGGGATTCGGAAACTGGCTTTTACCTTTAATACTTGGAGCCCCCGATATAGCATTCCCTCGACTCAACAACATGAGATTCTGACTACTTCCCCCATCACTGATCCTTTTAGTGTCCTCTGCGGCGGTAGAAAAAGGCGCTGGTACGGGGTGAACTGTTTATCCGCCTCTAGCAAGAAATCTTGCCCACGCAGGCCCGTCTGTAGATTTAGCCATCTTTTCCCTTCATTTAGCGGGTGCGTCTTCTATTCTAGGGGCTATTAATTTTATCACCACAGTTATTAATATGCGTTGAAGAGGATTACGTCTTGAACGAATTCCCCTGTTTGTCTGAGCTGTGCTAATTACAGTTGTTCTTCTACTTCTATCTTTACCAGTGCTAGCAGGTGCCATTACCATACTTCTTACCGACCGAAACCTCAATACTTCATTCTTTGATCCTGCCGGTGGTGGAGACCCCATCCTCTACTAGCACTTATTCTGATTTTTCGATCACCCTGATGTTGAGTCATAGTGAATTCCTGA")
    expect_equal(as.character(A_chloroticaRead@primaryAASeqS1), "HFIFYSGRLSRNGWSRYKTSNSNRAKTTRSVPGQRPTIQYYRYCTRICNNLLSSNACIHRGIRKLAFTFNTWSPRYSIPSTQQHEILTTSPITDPFSVLCGGRKRRWYGVNCLSASSKKSCPRRPVCRFSHLFPSFSGCVFYSRGY*FYHHSY*YALKRITS*TNSPVCLSCANYSCSSTSIFTSASRCHYHTSYRPKPQYFIL*SCRWWRPHPLLALILIFRSP*C*VILNS*")
    expect_equal(as.character(A_chloroticaRead@primaryAASeqS2), "TLYFILGV*AGMVGAGIRLLIRIELRQPGAFLGRDQLYNTIVTAHAFVIIFFLVMPVFIGGFGNWLLPLILGAPDIAFPRLNNMRF*LLPPSLILLVSSAAVEKGAGTG*TVYPPLARNLAHAGPSVDLAIFSLHLAGASSILGAINFITTVINMR*RGLRLERIPLFV*AVLITVVLLLLSLPVLAGAITILLTDRNLNTSFFDPAGGGDPILY*HLF*FLDHPDVESY*IP")
    expect_equal(as.character(A_chloroticaRead@primaryAASeqS3), "LYILFWASEQEWLEPV*DF*FESS*DNQERSWAETNYTILSLLHTHL**SSF**CLYSSGDSETGFYL*YLEPPI*HSLDSTT*DSDYFPHH*SF*CPLRR*KKALVRGELFIRL*QEILPTQARL*I*PSFPFI*RVRLLF*GLLILSPQLLICVEEDYVLNEFPCLSELC*LQLFFYFYLYQC*QVPLPYFLPTETSILHSLILPVVETPSSTSTYSDF*ITLMLSHTEFL")
    expect_equal(A_chloroticaRead@ChromatogramParam@baseNumPerRow, 100)
    expect_equal(A_chloroticaRead@ChromatogramParam@heightPerRow, 200)
    expect_equal(A_chloroticaRead@ChromatogramParam@signalRatioCutoff, 0.33)
    expect_equal(A_chloroticaRead@ChromatogramParam@showTrimmed, TRUE)

    expect_equal(A_chloroticaRead@QualityReport@TrimmingMethod, "M1")
    expect_equal(A_chloroticaRead@QualityReport@M1TrimmingCutoff, 0.0001, tolerance=1e-6)
    expect_equal(A_chloroticaRead@QualityReport@M2CutoffQualityScore, NULL)
    expect_equal(A_chloroticaRead@QualityReport@M2SlidingWindowSize, NULL)
    expect_equal(length(A_chloroticaRead@QualityReport@qualityPhredScoresRaw), 703)
    expect_equal(length(A_chloroticaRead@QualityReport@qualityPhredScores), 702)
    expect_equal(length(A_chloroticaRead@QualityReport@qualityBaseScores), 702)

    expect_equal(A_chloroticaRead@QualityReport@rawSeqLength, 702)
    expect_equal(A_chloroticaRead@QualityReport@trimmedSeqLength, 461)
    expect_equal(A_chloroticaRead@QualityReport@trimmedStartPos, 16)
    expect_equal(A_chloroticaRead@QualityReport@trimmedFinishPos, 477)
    expect_equal(A_chloroticaRead@QualityReport@rawMeanQualityScore, 52.87607, tolerance=1e-6)
    expect_equal(A_chloroticaRead@QualityReport@trimmedMeanQualityScore, 58.20779, tolerance=1e-6)
    expect_equal(A_chloroticaRead@QualityReport@rawMinQualityScore, 1)
    expect_equal(A_chloroticaRead@QualityReport@trimmedMinQualityScore, 13)
    expect_equal(A_chloroticaRead@QualityReport@remainingRatio, 0.6566952, tolerance=1e-6)
})

test_that("SangerRead Make Base Call", {
    baseCall <- MakeBaseCalls(A_chloroticaRead, signalRatioCutoff = 0.33)
    expect_type(baseCall, "S4")
    expect_s4_class(baseCall, "SangerRead")
    expect_equal(baseCall@readFeature, "Forward Read")
    expect_equal(basename(baseCall@readFileName), "ACHLO006-09[LCO1490_t1,HCO2198_t1]_F_1.ab1")
    expect_equal(as.character(baseCall@primarySeq), "CACTTTATATTTTATTCTGGGCGTCTGAGCAGGAATGGTTGGAGCCGGTATAAGACTTCTAATTCGAATCGAGCTAAGACAACCAGGAGCGTTCCTGGGCAGAGACCAACTATACAATACTATCGTTACTGCACACGCATTTGTAATAATCTTCTTTCTAGTAATGCCTGTATTCATCGGGGGATTCGGAAACTGGCTTTTACCTTTAATACTTGGAGCCCCCGATATAGCATTCCCTCGACTCAACAACATGAGATTCTGACTACTTCCCCCATCACTGATCCTTTTAGTGTCCTCTGCGGCGGTAGAAAAAGGCGCTGGTACGGGGTGAACTGTTTATCCGCCTCTAGCAAGAAATCTTGCCCACGCAGGCCCGTCTGTAGATTTAGCCATCTTTTCCCTTCATTTAGCGGGTGCGTCTTCTATTCTAGGGGCTATTAATTTTATCACCACAGTTATTAATATGCGTTGAAGAGGATTACGTCTTGAACGAATTCCCCTGTTTGTCTGAGCTGTGCTAATTACAGTTGTTCTTCTACTTCTATCTTTACCAGTGCTAGCAGGTGCCATTACCATACTTCTTACCGACCGAAACCTCAATACTTCATTCTTTGATCCTGCCGGTGGTGGAGACCCCATCCTCTACTAGCACTTATTCTGATTTTTAGATCACCCTGATGTTGAGTCATACTGAATTCCTGA")
    expect_equal(as.character(baseCall@secondarySeq), "TACTTTATATTTTATTCTGGGCGTCTGAGCAGGAATGGTTGGAGCCGGTATAAGACTTCTAATTCGAATCGAGCTAAGACAACCAGGAGCGTTCCTGGGCAGAGACCAACTATACAATACTATCGTTACTGCACACGCATTTGTAATAATCTTCTTTCTAGTAATGCCTGTATTCATCGGGGGATTCGGAAACTGGCTTTTACCTTTAATACTTGGAGCCCCCGATATAGCATTCCCTCGACTCAACAACATGAGATTCTGACTACTTCCCCCATCACTGATCCTTTTAGTGTCCTCTGCGGCGGTAGAAAAAGGCGCTGGTACGGGGTGAACTGTTTATCCGCCTCTAGCAAGAAATCTTGCCCACGCAGGCCCGTCTGTAGATTTAGCCATCTTTTCCCTTCATTTAGCGGGTGCGTCTTCTATTCTAGGGGCTATTAATTTTATCACCACAGTTATTAATATGCGTTGAAGAGGATTACGTCTTGAACGAATTCCCCTGTTTGTCTGAGCTGTGCTAATTACAGTTGTTCTTCTACTTCTATCTTTACCAGTGCTAGCAGGTGCCATTACCATACTTCTTACCGACCGAAACCTCAATACTTCATTCTTTGATCCTGCCGGTGGTGGAGACCCCATCCTCTACTAGCACTTATTCTGATTTTTCGATCACCCTGATGTTGAGTCATAGTGAATTCCTGA")
    expect_equal(as.character(baseCall@primaryAASeqS1), "HFIFYSGRLSRNGWSRYKTSNSNRAKTTRSVPGQRPTIQYYRYCTRICNNLLSSNACIHRGIRKLAFTFNTWSPRYSIPSTQQHEILTTSPITDPFSVLCGGRKRRWYGVNCLSASSKKSCPRRPVCRFSHLFPSFSGCVFYSRGY*FYHHSY*YALKRITS*TNSPVCLSCANYSCSSTSIFTSASRCHYHTSYRPKPQYFIL*SCRWWRPHPLLALILIFRSP*C*VILNS*")
    expect_equal(as.character(baseCall@primaryAASeqS2), "TLYFILGV*AGMVGAGIRLLIRIELRQPGAFLGRDQLYNTIVTAHAFVIIFFLVMPVFIGGFGNWLLPLILGAPDIAFPRLNNMRF*LLPPSLILLVSSAAVEKGAGTG*TVYPPLARNLAHAGPSVDLAIFSLHLAGASSILGAINFITTVINMR*RGLRLERIPLFV*AVLITVVLLLLSLPVLAGAITILLTDRNLNTSFFDPAGGGDPILY*HLF*FLDHPDVESY*IP")
    expect_equal(as.character(baseCall@primaryAASeqS3), "LYILFWASEQEWLEPV*DF*FESS*DNQERSWAETNYTILSLLHTHL**SSF**CLYSSGDSETGFYL*YLEPPI*HSLDSTT*DSDYFPHH*SF*CPLRR*KKALVRGELFIRL*QEILPTQARL*I*PSFPFI*RVRLLF*GLLILSPQLLICVEEDYVLNEFPCLSELC*LQLFFYFYLYQC*QVPLPYFLPTETSILHSLILPVVETPSSTSTYSDF*ITLMLSHTEFL")
    expect_equal(baseCall@ChromatogramParam@baseNumPerRow, 100)
    expect_equal(baseCall@ChromatogramParam@heightPerRow, 200)
    expect_equal(baseCall@ChromatogramParam@signalRatioCutoff, 0.33)
    expect_equal(baseCall@ChromatogramParam@showTrimmed, TRUE)

    expect_equal(baseCall@QualityReport@TrimmingMethod, "M1")
    expect_equal(baseCall@QualityReport@M1TrimmingCutoff, 0.0001, tolerance=1e-6)
    expect_equal(baseCall@QualityReport@M2CutoffQualityScore, NULL)
    expect_equal(baseCall@QualityReport@M2SlidingWindowSize, NULL)
    expect_equal(length(baseCall@QualityReport@qualityPhredScoresRaw), 703)
    expect_equal(length(baseCall@QualityReport@qualityPhredScores), 702)
    expect_equal(length(baseCall@QualityReport@qualityBaseScores), 702)

    expect_equal(baseCall@QualityReport@rawSeqLength, 702)
    expect_equal(baseCall@QualityReport@trimmedSeqLength, 461)
    expect_equal(baseCall@QualityReport@trimmedStartPos, 16)
    expect_equal(baseCall@QualityReport@trimmedFinishPos, 477)
    expect_equal(baseCall@QualityReport@rawMeanQualityScore, 52.87607, tolerance=1e-6)
    expect_equal(baseCall@QualityReport@trimmedMeanQualityScore, 58.20779, tolerance=1e-6)
    expect_equal(baseCall@QualityReport@rawMinQualityScore, 1)
    expect_equal(baseCall@QualityReport@trimmedMinQualityScore, 13)
    expect_equal(baseCall@QualityReport@remainingRatio, 0.6566952, tolerance=1e-6)
})

test_that("SangerRead Make Base Call 2", {
    baseCall2 <- MakeBaseCalls(A_chloroticaRead, signalRatioCutoff = 0.01)
    expect_type(baseCall2, "S4")
    expect_s4_class(baseCall2, "SangerRead")
    expect_equal(baseCall2@readFeature, "Forward Read")
    expect_equal(basename(baseCall2@readFileName), "ACHLO006-09[LCO1490_t1,HCO2198_t1]_F_1.ab1")
    expect_equal(as.character(baseCall2@primarySeq), "CACTTTATANTNTATTCTNGGCGTCNGAGCAGGAATGGTTGGAGCNNGTATAAGANTTCTANTNCGAATCGAGCNAAGACANCNANGANCNTNCNNGGGCAGAGACCAANTNTANNNNNCNNNCNNNNNNGNNNNCNCNTTTGTAATAATCTTCTTTCTAGTAATGCCNGNATNNNNCGGGGGANNNNGAANCNGNCTTTTANNNTTANNANNNGGAGNCCNCNANNNNNNNTTCCCTCNACTCNANANNANNANANNCNGANTACTTCNCCCNTCNCNGANNCNTNTANTGTCCNCTGCGGCGNTAGAANAAGGCGCNGGNANGGNGTGAACNGTTTNTCNGCCTCTAGCANNAANNCNNGCNNACGNNGGCNCGNCTGTAGATTTANCCNTCTTTTCCCTTNATTTANNGGGTGCNTCNNCNATTCTAGGGNCTATTAATTTTATCACCACAGTTATTAATATGCGTTGAAGAGGATNACGTCTNGAACGAATTCCNNNGTTTGTCTGAGCTGTGCTAATTACAGTTGTTCTNCTACTTCTATCTNTACCAGTGCTANCAGGTGCCANTACCATACTTCTTACNGACCGAAACCTCAATACTTCATTCTTTGATCCTGCCGGTGGTGGAGACCCCATCCTCTACTAGCACTTATTCTGATNNNNAGATCACCCNGATGTNGAGTCATANTGAANTCCTGA")
    expect_equal(as.character(baseCall2@secondarySeq), "KYGTMCSSANMNSSGSCRNYAWATGNMTGWKYGTGGWTTRTWYGANNWASGCKWTNAMWMCNRNKMTKMKMSMWNCGACGKNKNSNAKNKNRNKNNAAMAKAAMCGACSNMNMYNNNNNWNNNKNNNNNNMNNNNTNRNAARWRKKMYKCTMMTMAMTMSWRGKRMGKNMNKRNNNNKMAAAAKNNNNWTKNWNWNKAMAAYNNNRRKNNSNNNMMSMNKWNKNYNNNNNNNMCTTWMRNCKMRNSNKNNKNNKNTNNKNMCNMSWMCTNWTWNMWNTNWKNNKNSNMSNSCSGKNKRMRAARANRSMGSNKKMMGMKNAWNSNMANWRWKYTNYSMMNMTNMWWMWMSMWSNNCSNNTNNMTNNSKMNNYMCNKWNTRAMGMTTMASNTWNCTMMMMTWTAMNKCRRSNNAMWMMTNMGNNKNGGSCAAGGTNTAGSMCYCCCMCSCGTWKTAWMMSGRGKGGRCTWARAAKGATWKSNGTWMCANMCSKMCKTGKKNNNAARRMMGRAAATAAMMWGGAGAAKAAMMAAMCRNCAGWMACGSSGRNSSGRAYAGTGCNTKYWMATTGNASTKGGGCRAGATGTNMAWTGCGTTCAASKTGGAAGGTGGARAGAGCGAATTAAAMMAMCYGARRGGSGAGACAGKGGGKGRRTCCAGRCGCNNNNCMAACTGKWNCCCMANCCGAGGGANAAAANGRCAGG")
    expect_equal(as.character(baseCall2@primaryAASeqS1), "HFIFYSGRLSRNGWSRYKTSNSNRAKTTRSVPGQRPTIQYYRYCTRICNNLLSSNACIHRGIRKLAFTFNTWSPRYSIPSTQQHEILTTSPITDPFSVLCGGRKRRWYGVNCLSASSKKSCPRRPVCRFSHLFPSFSGCVFYSRGY*FYHHSY*YALKRITS*TNSPVCLSCANYSCSSTSIFTSASRCHYHTSYRPKPQYFIL*SCRWWRPHPLLALILIFRSP*C*VILNS*")
    expect_equal(as.character(baseCall2@primaryAASeqS2), "TLYFILGV*AGMVGAGIRLLIRIELRQPGAFLGRDQLYNTIVTAHAFVIIFFLVMPVFIGGFGNWLLPLILGAPDIAFPRLNNMRF*LLPPSLILLVSSAAVEKGAGTG*TVYPPLARNLAHAGPSVDLAIFSLHLAGASSILGAINFITTVINMR*RGLRLERIPLFV*AVLITVVLLLLSLPVLAGAITILLTDRNLNTSFFDPAGGGDPILY*HLF*FLDHPDVESY*IP")
    expect_equal(as.character(baseCall2@primaryAASeqS3), "LYILFWASEQEWLEPV*DF*FESS*DNQERSWAETNYTILSLLHTHL**SSF**CLYSSGDSETGFYL*YLEPPI*HSLDSTT*DSDYFPHH*SF*CPLRR*KKALVRGELFIRL*QEILPTQARL*I*PSFPFI*RVRLLF*GLLILSPQLLICVEEDYVLNEFPCLSELC*LQLFFYFYLYQC*QVPLPYFLPTETSILHSLILPVVETPSSTSTYSDF*ITLMLSHTEFL")
    expect_equal(baseCall2@ChromatogramParam@baseNumPerRow, 100)
    expect_equal(baseCall2@ChromatogramParam@heightPerRow, 200)
    expect_equal(baseCall2@ChromatogramParam@signalRatioCutoff, 0.33)
    expect_equal(baseCall2@ChromatogramParam@showTrimmed, TRUE)

    expect_equal(baseCall2@QualityReport@TrimmingMethod, "M1")
    expect_equal(baseCall2@QualityReport@M1TrimmingCutoff, 0.0001, tolerance=1e-6)
    expect_equal(baseCall2@QualityReport@M2CutoffQualityScore, NULL)
    expect_equal(baseCall2@QualityReport@M2SlidingWindowSize, NULL)
    expect_equal(length(baseCall2@QualityReport@qualityPhredScoresRaw), 703)
    expect_equal(length(baseCall2@QualityReport@qualityPhredScores), 702)
    expect_equal(length(baseCall2@QualityReport@qualityBaseScores), 702)

    expect_equal(baseCall2@QualityReport@rawSeqLength, 702)
    expect_equal(baseCall2@QualityReport@trimmedSeqLength, 461)
    expect_equal(baseCall2@QualityReport@trimmedStartPos, 16)
    expect_equal(baseCall2@QualityReport@trimmedFinishPos, 477)
    expect_equal(baseCall2@QualityReport@rawMeanQualityScore, 52.87607, tolerance=1e-6)
    expect_equal(baseCall2@QualityReport@trimmedMeanQualityScore, 58.20779, tolerance=1e-6)
    expect_equal(baseCall2@QualityReport@rawMinQualityScore, 1)
    expect_equal(baseCall2@QualityReport@trimmedMinQualityScore, 13)
    expect_equal(baseCall2@QualityReport@remainingRatio, 0.6566952, tolerance=1e-6)
})
