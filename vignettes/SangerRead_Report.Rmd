---
title: "sangeranalyseR"
author: "Author: Kuan-Hao Chao (u7022787@anu.edu.au)"
date: "Last update: `r format(Sys.time(), '%d %B, %Y')`"
output: 
  BiocStyle::html_document:
    toc_float: true
    code_folding: hide
    fig_caption: yes
  BiocStyle::pdf_document: default
#bibliography: bibliography.bib
params:
  SangerRead: NULL
  outputDir: ""
  showChromatogram: FALSE
fontsize: 14pt
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\usepackage[utf8]{inputenc}
---

<style>
.jexcel_content { 
    height: 100 px !important;
}
</style>

# sangeranalyseR 'SangerRead' Report

```{r}
library(sangeranalyseR)
```

## Basic Project Information:

<details><summary>CLICK ME</summary>

<ul style="list-style-type:disc;">
  <li>**Output Directory : **  <span class="tab">*`r params$outputDir`*</span></li>

  <li>**Input Directory : **  <span class="tab"><i>`r dirname(params$SangerRead@readFileName)`</i></span></li>

  <li>**Input Filename : **  <span class="tab"><i>`r basename(params$SangerRead@readFileName)`</i></span></li>

  <li>**Read Feature : **  <span class="tab">*`r params$SangerRead@readFeature`*</span></li>
</ul>

</details>

--- 

## DNA Seqence
<details><summary>CLICK ME</summary>
```{r}
library(knitr)
Primary_Sequence <- (strsplit(as.character(params$SangerRead@primarySeq), "")[[1]])
Secondary_Sequence <- (strsplit(as.character(params$SangerRead@secondarySeq), "")[[1]])
Quality_Phred_Scores <- params$SangerRead@QualityReport@qualityPhredScores
frame <- data.frame(Primary_Sequence, Secondary_Sequence, Quality_Phred_Scores)

kable(data.frame(t(frame))) %>%
  kable_styling() %>%
  scroll_box(width = "100%", height = "100%")
```
</details>

--- 

## Amino Acids Sequence
<details><summary>CLICK ME</summary>
```{r}
library(knitr)
Primary_Sequence <- (strsplit(as.character(params$SangerRead@primaryAASeqS1), "")[[1]])
# 
# kable(data.frame(t(Primary_Sequence))) %>%
#   kable_styling() %>%
#   scroll_box(width = "100%", height = "100%")

primarySeq <- unlist(strsplit(
        as.character(params$SangerRead@primaryAASeqS1), ""))
primarySeqDF <- data.frame(
        t(data.frame(primarySeq)), stringsAsFactors = FALSE)
colnames(primarySeqDF) <- substr(colnames(primarySeqDF), 2, 100)
rownames(primarySeqDF) <- NULL
AstyleList <- SetCharStyleList(primarySeqDF, "A", "#1eff00")
TstyleList <- SetCharStyleList(primarySeqDF, "T", "#ff7a7a")
CstyleList <- SetCharStyleList(primarySeqDF, "C", "#7ac3ff")
GstyleList <- SetCharStyleList(primarySeqDF, "G", "#c9c9c9")
styleList <- c(AstyleList, TstyleList, CstyleList, GstyleList)
excelTable()
suppressMessages(
    excelTable(data = primarySeqDF, defaultColWidth = 30,
               editable = FALSE, rowResize = FALSE,
               columnResize = FALSE, allowInsertRow = FALSE,
               allowInsertColumn = FALSE, allowDeleteRow = FALSE,
               allowDeleteColumn = FALSE, allowRenameColumn = FALSE,
               style = styleList)
)
```
</details>

--- 

## Quality Trimming

<details><summary>CLICK ME</summary>

<ul style="list-style-type:disc;">

`r if(params$SangerRead@QualityReport@TrimmingMethod == "M1"){"<li>**Trimming Method**: <span class='tab'><i> Method 1 'Logarithmic Scale Trimming' </i></span></li>"}`

`r if(params$SangerRead@QualityReport@TrimmingMethod == "M2"){"<li>**Trimming Method**: <span class='tab'><i> Method 2 'Logarithmic Scale Sliding Window Trimming' </i></span></li>"}`

`r if(params$SangerRead@QualityReport@TrimmingMethod == "M1"){paste("<li>**M1 Trimming Cutoffe**: <span class='tab'><i>", params$SangerRead@QualityReport@M1TrimmingCutoff, "</i></span></li>")}`

`r if(params$SangerRead@QualityReport@TrimmingMethod == "M2"){paste("<li>**M2 Cutoff Quality Score**: <span class='tab'><i>", params$SangerRead@QualityReport@M2CutoffQualityScore, "</i></span></li>")}`

`r if(params$SangerRead@QualityReport@TrimmingMethod == "M2"){paste("<li>**M2 Cutoff Quality Score**: <span class='tab'><i>", params$SangerRead@QualityReport@M2SlidingWindowSize, "</i></span></li>")}`

  <li>**Raw Sequence Length**:  <span class="tab">*`r params$SangerRead@QualityReport@rawSeqLength`*</span></li>
  
  <li>**Trimmed Sequence Length**:  <span class="tab">*`r params$SangerRead@QualityReport@trimmedSeqLength`*</span></li>
  
  <li>**Trimmed Start Point**:  <span class="tab">*`r params$SangerRead@QualityReport@trimmedStartPos`*</span></li>
  
  <li>**Trimmed End Point**:  <span class="tab">*`r params$SangerRead@QualityReport@trimmedFinishPos`*</span></li>
  
  <li>**Raw Mean Quality Score**:  <span class="tab">*`r params$SangerRead@QualityReport@rawMeanQualityScore`*</span></li>

  <li>**Trimmed Mean Quality Score**:  <span class="tab">*`r params$SangerRead@QualityReport@trimmedMeanQualityScore`*</span></li>
  
  <li>**Raw Min Quality Score**:  <span class="tab">*`r params$SangerRead@QualityReport@rawMinQualityScore`*</span></li>
  
  <li>**Trimmed Min Quality Score**: <span class="tab">*`r params$SangerRead@QualityReport@trimmedMinQualityScore`*</span></li>
  
  <li>**Remaining Read Ratio**: <span class="tab">*`r params$SangerRead@QualityReport@remainingRatio`*</span></li>

</ul>

```{r}
qualityBasePlot(params$SangerRead)
```

</details>



  
--- 

## Chromatogram
<details><summary>CLICK ME</summary>

<ul style="list-style-type:disc;">

  <li>**Signal Ratio Cutoff**:  <span class="tab">*`r params$SangerRead@ChromatogramParam@signalRatioCutoff`*</span></li>

  <li>**Base Number Per Row**:  <span class="tab">*`r params$SangerRead@ChromatogramParam@baseNumPerRow`*</span></li>

  <li>**Height Per Row**:  <span class="tab">*`r params$SangerRead@ChromatogramParam@heightPerRow`*</span></li>
  
  <li>**Show Trimmed Region**:  <span class="tab">*`r params$SangerRead@ChromatogramParam@showTrimmed`*</span></li>
  
</ul>

```{r}
hetcalls <- MakeBaseCalls(params$SangerRead,
                          signalRatioCutoff = params$SangerRead@ChromatogramParam@signalRatioCutoff)
chromatogram(hetcalls,
             width = strtoi(params$SangerRead@ChromatogramParam@baseNumPerRow) - 20,
             height = round(params$SangerRead@ChromatogramParam@heightPerRow * 2.6 / 200, 2),
             trim5 = params$SangerRead@QualityReport@trimmedStartPos,
             trim3 = (params$SangerRead@QualityReport@rawSeqLength - params$SangerRead@QualityReport@trimmedFinishPos),
             showtrim = params$SangerRead@ChromatogramParam@showTrimmed,
             showcalls = "both", filename = file.path(params$outputDir, paste0(basename(params$SangerRead@readFileName), "_chromatogram.pdf")))
```

<img src="`r file.path(params$outputDir, paste0(basename(params$SangerRead@readFileName), "_chromatogram.pdf"))`" alt="some text"  width="100%" height="100%">

</details>





<style>
li{
    margin-top: 16px;
}
li:first-child {
    margin-top:0;
}
.tab {position:absolute;left:350px; }
</style>


