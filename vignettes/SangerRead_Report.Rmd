---
title: "sangeranalyseR"
author: "Author: Kuan-Hao Chao (u7022787@anu.edu.au)"
date: "Last update: `r format(Sys.time(), '%d %B, %Y')`"
output: 
  BiocStyle::html_document:
    toc_float: true
    fig_caption: yes
  BiocStyle::pdf_document: default
#bibliography: bibliography.bib
params:
  SangerRead: NULL
  outputDir: ""
  showChromatogram: FALSE
fontsize: 14pt
vignette: >
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\usepackage[utf8]{inputenc}
---

# sangeranalyseR 'SangerRead' Report

```{r echo=FALSE}
library(sangeranalyseR)
```

## Basic Project Information:

<details><summary>CLICK ME</summary>

<ul style="list-style-type:disc;">
  <li>**Output Directory : **  <span class="tab">*`r params$outputDir`*</span></li>

  <li>**Input Directory : **  <span class="tab"><i>`r dirname(params$SangerRead@readFileName)`</i></span></li>

  <li>**Input Filename : **  <span class="tab"><i>`r basename(params$SangerRead@readFileName)`</i></span></li>

  <li>**Read Feature : **  <span class="tab">*`r params$SangerRead@readFeature`*</span></li>
</ul>

</details>

--- 

## DNA Seqence
<details><summary>CLICK ME</summary>

### Primary Sequence
```{r echo=FALSE}
primarySeq <- unlist(strsplit(as.character(params$SangerRead@primarySeq), ""))
primarySeqDF <- data.frame(t(data.frame(primarySeq)), stringsAsFactors = FALSE)
colnames(primarySeqDF) <- substr(colnames(primarySeqDF), 2, 100)
rownames(primarySeqDF) <- NULL
AstyleList <- SetCharStyleList(primarySeqDF, "A", "#1eff00")
TstyleList <- SetCharStyleList(primarySeqDF, "T", "#ff7a7a")
CstyleList <- SetCharStyleList(primarySeqDF, "C", "#7ac3ff")
GstyleList <- SetCharStyleList(primarySeqDF, "G", "#c9c9c9")
styleList <- c(AstyleList, TstyleList, CstyleList, GstyleList)
suppressMessages(
    excelTable(data = primarySeqDF, defaultColWidth = 30,
               editable = FALSE, rowResize = FALSE,
               columnResize = FALSE, allowInsertRow = FALSE,
               allowInsertColumn = FALSE, allowDeleteRow = FALSE,
               allowDeleteColumn = FALSE, allowRenameColumn = FALSE,
               style = styleList, loadingSpin = TRUE)
)
```

### Secondary Sequence
```{r echo=FALSE}
secondarySeq <-unlist(strsplit(as.character(params$SangerRead@secondarySeq), ""))
secondarySeqDF <- data.frame(t(data.frame(secondarySeq)), stringsAsFactors = FALSE)
colnames(secondarySeqDF) <- substr(colnames(secondarySeqDF), 2, 100)
rownames(secondarySeqDF) <- NULL
AstyleList <- SetCharStyleList(secondarySeqDF, "A", "#1eff00")
TstyleList <- SetCharStyleList(secondarySeqDF, "T", "#ff7a7a")
CstyleList <- SetCharStyleList(secondarySeqDF, "C", "#7ac3ff")
GstyleList <- SetCharStyleList(secondarySeqDF, "G", "#c9c9c9")
styleList <- c(AstyleList, TstyleList, CstyleList, GstyleList)
suppressMessages(
    excelTable(data = secondarySeqDF, defaultColWidth = 30,
               editable = FALSE, rowResize = FALSE,
               columnResize = FALSE, allowInsertRow = FALSE,
               allowInsertColumn = FALSE, allowDeleteRow = FALSE,
               allowDeleteColumn = FALSE, allowRenameColumn = FALSE,
               style = styleList, loadingSpin = TRUE)
)
```

### Phred Quality Scores 
```{r echo=FALSE}
PhredScoreDF <- data.frame(t(data.frame(params$SangerRead@QualityReport@qualityPhredScores)), stringsAsFactors = FALSE)
colnames(PhredScoreDF) <- substr(colnames(PhredScoreDF), 2, 100)
rownames(PhredScoreDF) <- NULL
styleList <- SetAllStyleList(PhredScoreDF, "#ecffd9")
suppressMessages(
    excelTable(data = PhredScoreDF, defaultColWidth = 30, editable = FALSE,
               rowResize = FALSE, columnResize = FALSE,
               allowInsertRow = FALSE, allowInsertColumn = FALSE,
               allowDeleteRow = FALSE, allowDeleteColumn = FALSE,
               style = styleList, allowRenameColumn = FALSE,
               loadingSpin = TRUE)
)
```

</details>

--- 

## Amino Acids Sequence

<details><summary>CLICK ME</summary>

### Amino Acids Sequence frameshit 0
```{r echo=FALSE}
AAString <- data.frame(AAString(params$SangerRead@primaryAASeqS1))
AAStringDF <- data.frame(t(AAString), stringsAsFactors = FALSE)
colnames(AAStringDF) <- substr(colnames(AAStringDF), 2, 100)
rownames(AAStringDF) <- NULL
width <- rep(90, length(AAStringDF))
styleList1 <- SetAllStyleList(AAStringDF, "#ecffd9")
styleList2 <- SetCharStyleList (AAStringDF, "*", "#cf0000")
styleList <- c(styleList1, styleList2)
suppressMessages(
    excelTable(data = AAStringDF, columns = data.frame(width = width),
               defaultColWidth = 90, editable = FALSE, rowResize = FALSE,
               columnResize = FALSE, allowInsertRow = FALSE,
               allowInsertColumn = FALSE, allowDeleteRow = FALSE,
               allowDeleteColumn = FALSE, allowRenameColumn = FALSE,
               style = styleList)
)
```

### Amino Acids Sequence frameshit 1
```{r echo=FALSE}
AAString <- data.frame(AAString(params$SangerRead@primaryAASeqS2))
AAString <- rbind(NA, AAString)
AAStringDF <- data.frame(t(AAString), stringsAsFactors = FALSE)
colnames(AAStringDF) <- substr(colnames(AAStringDF), 2, 100)
rownames(AAStringDF) <- NULL
width <- rep(90, length(AAStringDF) - 1)
width <- c(30, width)
styleList1 <- SetAllStyleList(AAStringDF, "#ecffd9")
styleList2 <- SetCharStyleList (AAStringDF, "*", "#cf0000")
styleList <- c(styleList1, styleList2)
styleList[['A1']] <- 'background-color: black;'
suppressMessages(
    excelTable(data = AAStringDF, columns = data.frame(width = width),
               defaultColWidth = 90, editable = FALSE, rowResize = FALSE,
               columnResize = FALSE, allowInsertRow = FALSE,
               allowInsertColumn = FALSE, allowDeleteRow = FALSE,
               allowDeleteColumn = FALSE, allowRenameColumn = FALSE,
               style = styleList)
)
```

### Amino Acids Sequence frameshit 2
```{r echo=FALSE}
AAString <- data.frame(AAString(params$SangerRead@primaryAASeqS3))
AAString <- rbind(NA, NA, AAString)
AAStringDF <- data.frame(t(AAString), stringsAsFactors = FALSE)
colnames(AAStringDF) <- substr(colnames(AAStringDF), 2, 100)
rownames(AAStringDF) <- NULL
width <- rep(90, length(AAStringDF) - 2)
width <- c(30, 30, width)
styleList1 <- SetAllStyleList(AAStringDF, "#ecffd9")
styleList2 <- SetCharStyleList (AAStringDF, "*", "#cf0000")
styleList <- c(styleList1, styleList2)
styleList[['A1']] <- 'background-color: black;'
styleList[['B1']] <- 'background-color: black;'
suppressMessages(
    excelTable(data = AAStringDF, columns = data.frame(width = width),
               defaultColWidth = 90, editable = FALSE, rowResize = FALSE,
               columnResize = FALSE, allowInsertRow = FALSE,
               allowInsertColumn = FALSE, allowDeleteRow = FALSE,
               allowDeleteColumn = FALSE, allowRenameColumn = FALSE,
               style = styleList)
)
```

</details>

--- 

## Quality Trimming

<details><summary>CLICK ME</summary>

<ul style="list-style-type:disc;">

`r if(params$SangerRead@QualityReport@TrimmingMethod == "M1"){"<li>**Trimming Method**: <span class='tab'><i> Method 1 'Logarithmic Scale Trimming' </i></span></li>"}`

`r if(params$SangerRead@QualityReport@TrimmingMethod == "M2"){"<li>**Trimming Method**: <span class='tab'><i> Method 2 'Logarithmic Scale Sliding Window Trimming' </i></span></li>"}`

`r if(params$SangerRead@QualityReport@TrimmingMethod == "M1"){paste("<li>**M1 Trimming Cutoffe**: <span class='tab'><i>", params$SangerRead@QualityReport@M1TrimmingCutoff, "</i></span></li>")}`

`r if(params$SangerRead@QualityReport@TrimmingMethod == "M2"){paste("<li>**M2 Cutoff Quality Score**: <span class='tab'><i>", params$SangerRead@QualityReport@M2CutoffQualityScore, "</i></span></li>")}`

`r if(params$SangerRead@QualityReport@TrimmingMethod == "M2"){paste("<li>**M2 Cutoff Quality Score**: <span class='tab'><i>", params$SangerRead@QualityReport@M2SlidingWindowSize, "</i></span></li>")}`

  <li>**Raw Sequence Length**:  <span class="tab">*`r params$SangerRead@QualityReport@rawSeqLength`*</span></li>
  
  <li>**Trimmed Sequence Length**:  <span class="tab">*`r params$SangerRead@QualityReport@trimmedSeqLength`*</span></li>
  
  <li>**Trimmed Start Point**:  <span class="tab">*`r params$SangerRead@QualityReport@trimmedStartPos`*</span></li>
  
  <li>**Trimmed End Point**:  <span class="tab">*`r params$SangerRead@QualityReport@trimmedFinishPos`*</span></li>
  
  <li>**Raw Mean Quality Score**:  <span class="tab">*`r params$SangerRead@QualityReport@rawMeanQualityScore`*</span></li>

  <li>**Trimmed Mean Quality Score**:  <span class="tab">*`r params$SangerRead@QualityReport@trimmedMeanQualityScore`*</span></li>
  
  <li>**Raw Min Quality Score**:  <span class="tab">*`r params$SangerRead@QualityReport@rawMinQualityScore`*</span></li>
  
  <li>**Trimmed Min Quality Score**: <span class="tab">*`r params$SangerRead@QualityReport@trimmedMinQualityScore`*</span></li>
  
  <li>**Remaining Read Ratio**: <span class="tab">*`r params$SangerRead@QualityReport@remainingRatio`*</span></li>

</ul>

```{r echo=FALSE}
qualityBasePlot(params$SangerRead)
```

</details>
  
--- 

## Chromatogram
<details><summary>CLICK ME</summary>

<ul style="list-style-type:disc;">

  <li>**Signal Ratio Cutoff**:  <span class="tab">*`r params$SangerRead@ChromatogramParam@signalRatioCutoff`*</span></li>

  <li>**Base Number Per Row**:  <span class="tab">*`r params$SangerRead@ChromatogramParam@baseNumPerRow`*</span></li>

  <li>**Height Per Row**:  <span class="tab">*`r params$SangerRead@ChromatogramParam@heightPerRow`*</span></li>
  
  <li>**Show Trimmed Region**:  <span class="tab">*`r params$SangerRead@ChromatogramParam@showTrimmed`*</span></li>
  
</ul>

```{r echo=FALSE}
hetcalls <- MakeBaseCalls(params$SangerRead,
                          signalRatioCutoff = params$SangerRead@ChromatogramParam@signalRatioCutoff)
chromatogram(hetcalls,
             width = strtoi(params$SangerRead@ChromatogramParam@baseNumPerRow) - 20,
             height = round(params$SangerRead@ChromatogramParam@heightPerRow * 2.6 / 200, 2),
             trim5 = params$SangerRead@QualityReport@trimmedStartPos,
             trim3 = (params$SangerRead@QualityReport@rawSeqLength - params$SangerRead@QualityReport@trimmedFinishPos),
             showtrim = params$SangerRead@ChromatogramParam@showTrimmed,
             showcalls = "both", filename = file.path(params$outputDir, paste0(basename(params$SangerRead@readFileName), "_chromatogram.pdf")))
```

<img src="`r file.path(params$outputDir, paste0(basename(params$SangerRead@readFileName), "_chromatogram.pdf"))`" alt="some text"  width="100%" height="100%">

</details>





<style>
li{
    margin-top: 16px;
}
li:first-child {
    margin-top:0;
}
.tab {position:absolute;left:350px; }

.jexcel_content { 
    height: 60px !important;
}

</style>


